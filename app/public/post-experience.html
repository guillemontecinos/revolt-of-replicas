<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>La Revuelta de las Réplicas</title>
    <link rel="stylesheet" href="styles/styles-post-experience.css" />
</head>
<body>
    
</body>
    <div class="post-exp">
        <div class="header">
            <!-- <div class="header-image">
                <img src='/thumbnails/revoltofreplicas-1.jpg'>
            </div> -->
            <div class="title">
                La Revuelta de las Réplicas
            </div>
        </div>
        <div class="instructions">
            Publica tu versión de La Revuelta de las Réplicas en Instagram, ingresando tu comentario y cuenta de Instagram.
        </div>
        <div class="data">
            <div class="comment-container">
                <textarea id="comment" class="comment" placeholder="Escribe tu comentario"></textarea>
            </div>
            <div class="handler-container">
                <input type="text" id="handler" class="handler" placeholder="@larevueltadelasreplicas">
            </div>
        </div>  
        <div class="election-buttons">
            <button type="button" class="submit-button" id="submit-button">PUBLICAR</button>
            <button type="button" class="skip-button" id="skip-button">SALTAR</button>
        </div>
</div>
    <script>
        let commentTextArea = document.getElementById('comment')
        let handlerInput = document.getElementById('handler')

        let submitButton = document.getElementById('submit-button')
        let skipButton = document.getElementById('skip-button')
        
        submitButton.addEventListener('click', postToIg)
        skipButton.addEventListener('click', backToWelcome)

        function postToIg() {
            let comment = commentTextArea.value
            let handler = handlerInput.value
            if (comment.length > 0 && handler.length > 0) {
                // check if handler starts with @
                if(handler[0] != '@'){
                    handler = '@' + handler
                }
                comment += '\n.\n.\n.\nComentario publicado por ' + handler + ' en exhibición realizada en galeriacasa_amalia'
                let data = JSON.stringify({'comment':comment})
                let xhr = new XMLHttpRequest()
                xhr.open('POST', '/post-to-instagram', true)
                xhr.setRequestHeader("Content-Type", "application/json")
                console.log('post to instagram')
                xhr.send(data)
                backToWelcome()
            }
            else if(comment.length > 0 && handler.length == 0){
                handlerInput.value = ''
                handlerInput.placeholder = '@larevueltadelasreplicas'
            }
            else if(comment.length == 0 && handler.length > 0){
                commentTextArea.value = ''
                commentTextArea.placeholder = 'Asegúrate de escribir un comentario e ingresar tu usuario de instagram antes de publicar.'
            }
            else {
                commentTextArea.value = ''
                commentTextArea.placeholder = 'Asegúrate de escribir un comentario e ingresar tu usuario de instagram antes de publicar.'
                handlerInput.value = ''
                handlerInput.placeholder = '@larevueltadelasreplicas'
            }
        }

        function backToWelcome() {
            window.location.href = "/"
        }
    </script>
</html>